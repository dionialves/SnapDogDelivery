<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{admin/fragments/layout :: layout(
          pageTitle=${pageTitle}, 
          activeMenu=${activeMenu}, 
          pageSubtitle=${pageSubtitle},
          headerActions=~{::headerActions},
          content=~{::content}
      )}">

<head>
    <title>Clientes</title>
</head>

<body>

    <!-- Ações do Header - Botão Novo Cliente -->
    <th:block th:fragment="headerActions">
        <a th:href="@{/admin/client/new}"
            class="inline-flex items-center gap-2 bg-snapdog-600 hover:bg-snapdog-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
            <i data-lucide="plus" class="w-5 h-5"></i>
            Novo Cliente
        </a>
    </th:block>

    <!-- Conteúdo Principal -->
    <th:block th:fragment="content">

        <!-- Mensagens de Feedback -->
        <div th:if="${messagem}" class="mb-6 p-4 rounded-lg flex items-center gap-3"
            th:classappend="${messageType == 'sucesso'} ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
            <i th:if="${messageType == 'sucesso'}" data-lucide="check-circle" class="w-5 h-5"></i>
            <i th:if="${messageType == 'erro'}" data-lucide="alert-circle" class="w-5 h-5"></i>
            <span th:text="${messagem}"></span>
        </div>

        <!-- Card da Tabela -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200">

            <!-- Header com Busca -->
            <div class="p-6 border-b border-gray-200">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                    <div>
                        <h2 class="text-lg font-semibold text-gray-800">Lista de Clientes</h2>
                        <p class="text-gray-500 text-sm mt-1">
                            <span th:text="${clients != null ? clients.size() : 0}">0</span> cliente(s) cadastrado(s)
                        </p>
                    </div>

                    <!-- Busca -->
                    <form th:action="@{/admin/clients}" method="get" class="flex gap-2">
                        <div class="relative">
                            <i data-lucide="search"
                                class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <input type="text" name="search" th:value="${search}"
                                placeholder="Buscar por nome, email..."
                                class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-snapdog-500 focus:border-snapdog-500 w-64">
                        </div>
                        <button type="submit"
                            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors">
                            Buscar
                        </button>
                    </form>
                </div>
            </div>

            <!-- Tabela -->
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Cliente</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Contato</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Cidade</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Cadastro</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Ações</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">

                        <!-- Linha vazia quando não há clientes -->
                        <tr th:if="${clients == null or #lists.isEmpty(clients)}">
                            <td colspan="5" class="px-6 py-12 text-center">
                                <div class="flex flex-col items-center">
                                    <i data-lucide="users" class="w-12 h-12 text-gray-300 mb-4"></i>
                                    <p class="text-gray-500 font-medium">Nenhum cliente encontrado</p>
                                    <p class="text-gray-400 text-sm mt-1">Cadastre seu primeiro cliente clicando no
                                        botão acima</p>
                                </div>
                            </td>
                        </tr>

                        <!-- Linhas dos clientes -->
                        <tr th:each="client : ${clients}" class="hover:bg-gray-50">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-snapdog-100 rounded-full flex items-center justify-center">
                                        <span th:text="${#strings.substring(client.name, 0, 1).toUpperCase()}"
                                            class="font-semibold text-snapdog-600">D</span>
                                    </div>
                                    <div>
                                        <p th:text="${client.name}" class="font-medium text-gray-800">Nome do Cliente
                                        </p>
                                        <p th:text="${client.email}" class="text-gray-500 text-sm">email@exemplo.com</p>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-2 text-gray-600">
                                    <i data-lucide="phone" class="w-4 h-4"></i>
                                    <span th:text="${client.phone}">99999-9999</span>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span th:text="${client.city + ' - ' + client.state}" class="text-gray-600">Cidade -
                                    UF</span>
                            </td>
                            <td class="px-6 py-4">
                                <span th:if="${client.createdAt}"
                                    th:text="${#temporals.format(client.createdAt, 'dd/MM/yyyy')}"
                                    class="text-gray-500 text-sm">01/01/2025</span>
                                <span th:unless="${client.createdAt}" class="text-gray-400 text-sm">-</span>
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex items-center justify-end gap-2">
                                    <a th:href="@{/admin/client/{id}(id=${client.id})}"
                                        class="p-2 text-gray-500 hover:text-snapdog-600 hover:bg-snapdog-50 rounded-lg transition-colors"
                                        title="Editar">
                                        <i data-lucide="pencil" class="w-4 h-4"></i>
                                    </a>
                                    <button type="button" th:data-id="${client.id}" th:data-nome="${client.name}"
                                        onclick="confirmarExclusao(this)"
                                        class="p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                                        title="Excluir">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>

                    </tbody>
                </table>
            </div>

        </div>

        <!-- Modal de Confirmação de Exclusão -->
        <div id="modalExclusao" class="hidden fixed inset-0 z-50">
            <div class="absolute inset-0 bg-black/50" onclick="fecharModal()"></div>
            <div
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-xl w-full max-w-md p-6">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                        <i data-lucide="alert-triangle" class="w-6 h-6 text-red-600"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Confirmar Exclusão</h3>
                        <p class="text-gray-500 text-sm">Esta ação não pode ser desfeita</p>
                    </div>
                </div>
                <p class="text-gray-600 mb-6">
                    Tem certeza que deseja excluir o cliente <strong id="nomeClienteExclusao"></strong>?
                </p>
                <div class="flex gap-3 justify-end">
                    <button onclick="fecharModal()"
                        class="px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                        Cancelar
                    </button>
                    <form id="formExclusao" method="post">
                        <button type="submit"
                            class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors">
                            Sim, Excluir
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <script>
            function confirmarExclusao(btn) {
                const id = btn.dataset.id;
                const nome = btn.dataset.nome;

                document.getElementById('nomeClienteExclusao').textContent = nome;
                document.getElementById('formExclusao').action = '/admin/client/delete/' + id;
                document.getElementById('modalExclusao').classList.remove('hidden');
            }

            function fecharModal() {
                document.getElementById('modalExclusao').classList.add('hidden');
            }

            // Fechar com ESC
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') fecharModal();
            });
        </script>

    </th:block>

</body>

</html>
